version: '3.8'

services:
  scantocookbook-local:
    build: 
      context: .
      dockerfile: Dockerfile
    image: ghcr.io/scan-to-cookbook/scantocookbook:latest
    container_name: scantocookbook-local
    restart: unless-stopped
    
    # Force local mode
    environment:
      - MODE=local
      
      # OpenAI Configuration (required)
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - OPENAI_BASE_URL=${OPENAI_BASE_URL:-https://api.openai.com/v1}
      - LLM_MODEL=${LLM_MODEL:-gpt-4-vision-preview}
      
      # Local Processing Settings
      - LOCAL_INPUT_DIR=${LOCAL_INPUT_DIR:-/app/input}
      - LOCAL_OUTPUT_DIR=${LOCAL_OUTPUT_DIR:-/app/output}
      
      # Processing Options
      - VISION_PROMPT=${VISION_PROMPT:-Analyze this image and extract recipe information including ingredients, instructions, and cooking time.}
      - MAX_IMAGE_SIZE=${MAX_IMAGE_SIZE:-10485760}
      - SUPPORTED_FORMATS=${SUPPORTED_FORMATS:-jpg,jpeg,png}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
    
    # Volume mounts for local mode
    volumes:
      - ./test_images:/app/input:ro     # Mount your test images here
      - ./output:/app/output             # Results will appear here
      - ./logs:/app/logs               # Application logs
      - ./temp:/app/temp               # Temporary files