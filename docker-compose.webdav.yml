services:
  scan-to-recipe-webdav:
    build: 
      context: .
      dockerfile: Dockerfile
    image: ghcr.io/scan-to-recipe:latest
    container_name: scan-to-recipe-webdav
    
    # Force WebDAV mode
    environment:
      - MODE=webdav
      
      # OpenAI Configuration (required)
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - OPENAI_BASE_URL=${OPENAI_BASE_URL:-https://api.openai.com/v1}
      - LLM_MODEL=${LLM_MODEL:-gpt-4-vision-preview}
      
      # WebDAV Configuration (required for webdav mode)
      - WEBDAV_SOURCE_HOST=${WEBDAV_SOURCE_HOST}
      - WEBDAV_SOURCE_USERNAME=${WEBDAV_SOURCE_USERNAME}
      - WEBDAV_SOURCE_PASSWORD=${WEBDAV_SOURCE_PASSWORD}
      - WEBDAV_DEST_HOST=${WEBDAV_DEST_HOST}
      - WEBDAV_DEST_USERNAME=${WEBDAV_DEST_USERNAME}
      - WEBDAV_DEST_PASSWORD=${WEBDAV_DEST_PASSWORD}
      
      # Processing Options
      - VISION_PROMPT=${VISION_PROMPT:-Analyze this image and extract recipe information including ingredients, instructions, and cooking time.}
      - MAX_IMAGE_SIZE=${MAX_IMAGE_SIZE:-10485760}
      - SUPPORTED_FORMATS=${SUPPORTED_FORMATS:-jpg,jpeg,png}
      - TEMP_DIR=${TEMP_DIR:-/app/temp}
      - MAX_RETRIES=${MAX_RETRIES:-3}
      - RETRY_DELAY=${RETRY_DELAY:-2}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
    
    # Volume mounts for WebDAV mode
    volumes:
      - ./logs:/app/logs              # Application logs
      - ./temp:/app/temp              # Temporary files
      - ./input:/app/input             # Optional input files
      - ./output:/app/output           # Optional output files
